var Cross=function(){var a,b,c,d,e,f=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],g=function(c){void 0!=c&&(_debug=c.Debug),a=new Date,b="http://flingerbackend.cloudapp.net:3500",h(),j(),k()},h=function(){_flingerElement=document.querySelector("[data-flinger]"),e=void 0!=_flingerElement.dataset.flinger&&_flingerElement.dataset.flinger},i=function(){return a.getTime()},j=function(){var a="-",b={};screen.width&&(width=screen.width?screen.width:"",height=screen.height?screen.height:"",b.width=width,b.height=height);var d,e,g,h=navigator.appVersion,i=navigator.userAgent,j=navigator.appName,k=""+parseFloat(navigator.appVersion),l=parseInt(navigator.appVersion,10);(e=i.indexOf("Opera"))!=-1&&(j="Opera",k=i.substring(e+6),(e=i.indexOf("Version"))!=-1&&(k=i.substring(e+8))),(e=i.indexOf("OPR"))!=-1?(j="Opera",k=i.substring(e+4)):(e=i.indexOf("Edge"))!=-1?(j="Microsoft Edge",k=i.substring(e+5)):(e=i.indexOf("MSIE"))!=-1?(j="Microsoft Internet Explorer",k=i.substring(e+5)):(e=i.indexOf("Chrome"))!=-1?(j="Chrome",k=i.substring(e+7)):(e=i.indexOf("Safari"))!=-1?(j="Safari",k=i.substring(e+7),(e=i.indexOf("Version"))!=-1&&(k=i.substring(e+8))):(e=i.indexOf("Firefox"))!=-1?(j="Firefox",k=i.substring(e+8)):i.indexOf("Trident/")!=-1?(j="Microsoft Internet Explorer",k=i.substring(i.indexOf("rv:")+3)):(d=i.lastIndexOf(" ")+1)<(e=i.lastIndexOf("/"))&&(j=i.substring(d,e),k=i.substring(e+1),j.toLowerCase()==j.toUpperCase()&&(j=navigator.appName)),(g=k.indexOf(";"))!=-1&&(k=k.substring(0,g)),(g=k.indexOf(" "))!=-1&&(k=k.substring(0,g)),(g=k.indexOf(")"))!=-1&&(k=k.substring(0,g)),l=parseInt(""+k,10),isNaN(l)&&(k=""+parseFloat(navigator.appVersion),l=parseInt(navigator.appVersion,10));var m=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(h),n=!!navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||n||(document.cookie="testcookie",n=document.cookie.indexOf("testcookie")!=-1);var o=a;for(var p in f){var q=f[p];if(q.r.test(i)){o=q.s;break}}var r=a;switch(/Windows/.test(o)&&(r=/Windows (.*)/.exec(o)[1],o="Windows"),o){case"Mac OS X":r=/Mac OS X (10[\.\_\d]+)/.exec(i)[1];break;case"Android":r=/Android ([\.\_\d]+)/.exec(i)[1];break;case"iOS":r=/OS (\d+)_(\d+)_?(\d+)?/.exec(h),r=r[1]+"."+r[2]+"."+(0|r[3])}var s="no check";if("undefined"!=typeof swfobject){var t=swfobject.getFlashPlayerVersion();s=t.major>0?t.major+"."+t.minor+" r"+t.release:a}c={screen:b,browser:j,browserVersion:k,browserMajorVersion:l,mobile:m,os:o,osVersion:r,cookies:n,flashVersion:s,fullUserAgent:navigator.userAgent}},k=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.onload=l,b.src="http://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js",a.appendChild(b)},l=function(){geoip2.city(m,n)},m=function(a){d=a},n=function(){d=null},o=function(){return{X:window.pageXOffset,Y:window.pageYOffset}},p=function(){return b},q=function(){return c},r=function(){return d},s=function(){return e};return{Initialize:g,TimeStamp:i,GetScrollPosition:o,GetServerUri:p,GetClientInformation:q,GetClientLocation:r,GetApiKey:s}}();Cross.Initialize();var SocketHub=function(){var a,b,c,d=function(b){void 0!=b&&(a=b.Debug),e()},e=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=f,b.src="https://cdn.socket.io/socket.io-1.4.5.js",a.appendChild(b)},f=function(){g(),void 0!==a&&a&&console.log("Socket Library is loaded succesfully")},g=function(){void 0!==a&&a&&console.log("Connecting to server..."),b=io(Cross.GetServerUri()),h()},h=function(){b.on("connect",function(){void 0!==a&&a&&console.log("Connection to server succesfully"),b.emit("Coplest.Flinger.AddApiKeyToSocket",{ApiKey:Cross.GetApiKey()}),k("SocketConnected")}),b.on("Coplest.Flinger.ServerEvent",function(a){k(a.Command,a.Values)}),b.on("disconnect",function(){void 0!==a&&a&&console.log("Disconected from server")})},i=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushInsight",a)},j=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushScreenshot",a)},k=function(a,b){c=new CustomEvent(a,b),document.dispatchEvent(c)},l=function(){return b};return{Initialize:d,GetSocket:l,PushInsight:i,PushScreenshot:j}}(),EventHub=function(){var a,b=[],c=[],d=[];document.addEventListener("SocketConnected",function(){b.length>0&&(b.forEach(function(a){SocketHub.PushInsight({Command:"Click",Values:{ApiKey:Cross.GetApiKey(),Event:a}})}),b.length=0),c.length>0&&(c.forEach(function(a){SocketHub.PushInsight({Command:"Movement",Values:{Api:Cross.GetApiKey(),Event:a}})}),c.length=0),d.length>0&&(d.forEach(function(a){SocketHub.PushInsight({Command:"Scroll",Values:{Api:Cross.GetApiKey(),Event:a}})}),d.length=0)},!1);var e=function(b){void 0!=b&&(a=b.Debug,i())},f=function(){document.addEventListener("click",l)},g=function(){document.onmousemove=k},h=function(){window.addEventListener("scroll",j,!1)},i=function(){var a=".dot {width: 1px; height: 1px; background-color: #000000; position: absolute;}",b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)},j=function(a){var b={Position:{X:this.scrollX,Y:this.scrollY},TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:Cross.GetClientLocation()};void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?SocketHub.PushInsight({Command:"Scroll",Values:{ApiKey:Cross.GetApiKey(),Event:b,Pathname:window.location.pathname}}):d.push(b)},k=function(b){var d,e,f,g;b=b||window.event,null==b.pageX&&null!=b.clientX&&(e=b.target&&b.target.ownerDocument||document,f=e.documentElement,g=e.body,b.pageX=b.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),b.pageY=b.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),void 0!==a&&a&&(d=document.createElement("div"),d.className="dot",d.style.left=b.pageX+"px",d.style.top=b.pageY+"px",document.body.appendChild(d));var h={Position:{X:b.pageX,Y:b.pageY},Scroll:Cross.GetScrollPosition(),TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:Cross.GetClientLocation()};void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?SocketHub.PushInsight({Command:"Movement",Values:{ApiKey:Cross.GetApiKey(),Event:h,Pathname:window.location.pathname}}):c.push(h)},l=function(c){var d={Position:{X:c.clientX,Y:c.clientY},Scroll:Cross.GetScrollPosition(),TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:Cross.GetClientLocation()};void 0!==a&&a&&console.log("Mouse coords: ("+c.clientX+", "+c.clientY+")"),void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?SocketHub.PushInsight({Command:"Click",Values:{ApiKey:Cross.GetApiKey(),Event:d,Pathname:window.location.pathname}}):b.push(d)},m=function(){return b},n=function(){return c},o=function(){return d};return{Initialize:e,ListenMouseClick:f,ListenMouseMovement:g,ListenMouseScroll:h,GetNotSentMouseClickEvents:m,GetNotSentMouseMovementEvents:n,GetNotSentMouseScrollEvents:o}}(),FormHub=function(){var a=10,b=function(){console.log("Inside a private method!"),a++},c=function(){console.log("This is a method I want to expose!")},d=function(){b()};return{first:c,second:d}}(),RATHub=function(){var a=10,b=function(){console.log("Inside a private method!"),a++},c=function(){console.log("This is a method I want to expose!")},d=function(){b()};return{first:c,second:d}}(),ScreenshotHub=function(){var a,b,c=function(b){void 0!=b&&(a=b.Debug),d(),i()},d=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=e,b.src="https://cdn.rawgit.com/niklasvh/html2canvas/0.5.0-alpha1/dist/html2canvas.min.js",a.appendChild(b)},e=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=f,b.src="https://cdn.rawgit.com/niklasvh/html2canvas/0.5.0-alpha1/dist/html2canvas.svg.min.js",a.appendChild(b)},f=function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div");c.id="screenshot-result",c.style.display="none",void 0!==a&&a&&(console.log("html2canvas Library is loaded succesfully"),c.style.display="block"),b.appendChild(c),g()},g=function(){html2canvas(document.body).then(function(a){document.getElementById("screenshot-result").appendChild(a),1==b&&h()})},h=function(){if(b){var a=document.querySelector("#screenshot-result>canvas");SocketHub.PushScreenshot({Command:"Scroll",Values:{Base64Data:a.toDataURL(),Endpoint:document.location.pathname,ApiKey:Cross.GetApiKey()}})}},i=function(){function a(){b=void 0!=JSON.parse(this.responseText).result&&JSON.parse(this.responseText).result}var c="/api/Site/DiscoveryMode/"+Cross.GetApiKey(),d=new XMLHttpRequest;d.addEventListener("load",a),d.open("GET",Cross.GetServerUri()+c),d.send()};return{Initialize:c,TakeScreenshot:g}}(),SocketHub=function(){var a,b,c,d=function(b){void 0!=b&&(a=b.Debug),e()},e=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=f,b.src="https://cdn.socket.io/socket.io-1.4.5.js",a.appendChild(b)},f=function(){g(),void 0!==a&&a&&console.log("Socket Library is loaded succesfully")},g=function(){void 0!==a&&a&&console.log("Connecting to server..."),b=io(Cross.GetServerUri()),h()},h=function(){b.on("connect",function(){void 0!==a&&a&&console.log("Connection to server succesfully"),b.emit("Coplest.Flinger.AddApiKeyToSocket",{ApiKey:Cross.GetApiKey()}),k("SocketConnected")}),b.on("Coplest.Flinger.ServerEvent",function(a){k(a.Command,a.Values)}),b.on("disconnect",function(){void 0!==a&&a&&console.log("Disconected from server")})},i=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushInsight",a)},j=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushScreenshot",a)},k=function(a,b){c=new CustomEvent(a,b),document.dispatchEvent(c)},l=function(){return b};return{Initialize:d,GetSocket:l,PushInsight:i,PushScreenshot:j}}(),Flinger=function(){var a,b,c=function(){a=document.querySelector("[data-flinger]"),b=void 0!=a.dataset.debug&&JSON.parse(a.dataset.debug),b===!0&&console.log("Flinger is on debug mode"),SocketHub.Initialize({Debug:b}),ScreenshotHub.Initialize({Debug:b}),EventHub.Initialize({Debug:b}),EventHub.ListenMouseClick(),EventHub.ListenMouseMovement(),EventHub.ListenMouseScroll()};return{Initialize:c,GetNotSentMouseClickEvents:EventHub.GetNotSentMouseClickEvents,GetNotSentMouseMovementEvents:EventHub.GetNotSentMouseMovementEvents,GetNotSentMouseScrollEvents:EventHub.GetNotSentMouseScrollEvents}}();Flinger.Initialize();