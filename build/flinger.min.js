var Cross=function(){var a,b,c,d,e,f,g,h,i,j,k=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],l=function(d){void 0!=d&&(_debug=d.Debug),a=new Date,b="http://crawlerbackend.azurewebsites.net",c="http://crawlersite-kernel.azurewebsites.net",m(),o(),u(null),v(null),w(null),x(null),y(null),F()},m=function(){_flingerElement=document.querySelector("[data-flinger]"),e=void 0!=_flingerElement.dataset.flinger&&_flingerElement.dataset.flinger},n=function(){return a.getTime()},o=function(){var a="-",b={};screen.width&&(width=screen.width?screen.width:"",height=screen.height?screen.height:"",b.width=width,b.height=height);var c,e,f,g=navigator.appVersion,h=navigator.userAgent,i=navigator.appName,j=""+parseFloat(navigator.appVersion),l=parseInt(navigator.appVersion,10);(e=h.indexOf("Opera"))!=-1&&(i="Opera",j=h.substring(e+6),(e=h.indexOf("Version"))!=-1&&(j=h.substring(e+8))),(e=h.indexOf("OPR"))!=-1?(i="Opera",j=h.substring(e+4)):(e=h.indexOf("Edge"))!=-1?(i="Microsoft Edge",j=h.substring(e+5)):(e=h.indexOf("MSIE"))!=-1?(i="Microsoft Internet Explorer",j=h.substring(e+5)):(e=h.indexOf("Chrome"))!=-1?(i="Chrome",j=h.substring(e+7)):(e=h.indexOf("Safari"))!=-1?(i="Safari",j=h.substring(e+7),(e=h.indexOf("Version"))!=-1&&(j=h.substring(e+8))):(e=h.indexOf("Firefox"))!=-1?(i="Firefox",j=h.substring(e+8)):h.indexOf("Trident/")!=-1?(i="Microsoft Internet Explorer",j=h.substring(h.indexOf("rv:")+3)):(c=h.lastIndexOf(" ")+1)<(e=h.lastIndexOf("/"))&&(i=h.substring(c,e),j=h.substring(e+1),i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)),(f=j.indexOf(";"))!=-1&&(j=j.substring(0,f)),(f=j.indexOf(" "))!=-1&&(j=j.substring(0,f)),(f=j.indexOf(")"))!=-1&&(j=j.substring(0,f)),l=parseInt(""+j,10),isNaN(l)&&(j=""+parseFloat(navigator.appVersion),l=parseInt(navigator.appVersion,10));var m=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(g),n=!!navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||n||(document.cookie="testcookie",n=document.cookie.indexOf("testcookie")!=-1);var o=a;for(var p in k){var q=k[p];if(q.r.test(h)){o=q.s;break}}var r=a;switch(/Windows/.test(o)&&(r=/Windows (.*)/.exec(o)[1],o="Windows"),o){case"Mac OS X":r=/Mac OS X (10[\.\_\d]+)/.exec(h)[1];break;case"Android":r=/Android ([\.\_\d]+)/.exec(h)[1];break;case"iOS":r=/OS (\d+)_(\d+)_?(\d+)?/.exec(g),r=r[1]+"."+r[2]+"."+(0|r[3])}var s="undefined";if("undefined"!=typeof swfobject){var t=swfobject.getFlashPlayerVersion();s=t.major>0?t.major+"."+t.minor+" r"+t.release:a}d={screen:b,browser:i,browserVersion:j,browserMajorVersion:l,mobile:m,os:o,osVersion:r,cookies:n,flashVersion:s,fullUserAgent:navigator.userAgent}},p=function(){return{X:window.pageXOffset,Y:window.pageYOffset}},q=function(){return b},r=function(){return c},s=function(){return d},t=function(){return e},u=function(a){f=a},v=function(a){g=a},w=function(a){h=a},x=function G(){i=G},y=function(a){j=a},z=function(){return f},A=function(){return g},B=function(){return h},C=function(){return i},D=function(){return j},E=function(a,b){for(var c=0;c<b.length;c++)if(b[c].Id===a)return b[c];return null},F=function(){String.prototype.toDOM=function(){var a,b=document,c=b.createElement("div"),d=b.createDocumentFragment();for(c.innerHTML=this;a=c.firstChild;)d.appendChild(a);return d}};return{Initialize:l,TimeStamp:n,GetScrollPosition:p,GetServerUri:q,GetCoreUri:r,GetClientInformation:s,GetApiKey:t,SearchObjectByIdOnArray:E,CanUseHeatmaps:z,CanUseRAT:A,CanUseFunnels:B,CanUseScreenRecorder:C,CanUseFormAnalysis:D,SetUseHeatmaps:u,SetUseRAT:v,SetUseFunnels:w,SetUseScreenRecorder:x,SetUseFormAnalysis:y,CreateStringToDOMPrototype:F}}();Cross.Initialize();var SocketHub=function(){var a,b,c,d,e,f,g=function(b){void 0!=b&&(a=b.Debug),h()},h=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=i,b.src="https://cdn.socket.io/socket.io-1.4.5.js",a.appendChild(b)},i=function(){j(),void 0!==a&&a&&console.log("Socket Library is loaded succesfully")},j=function(){void 0!==a&&a&&console.log("Connecting to server..."),b=io(Cross.GetServerUri()+"/user-pool-namespace",{query:"ApiKey="+Cross.GetApiKey()}),k()},k=function(){b.on("connect",function(){void 0!==a&&a&&console.log("Connection to server succesfully"),b.emit("Coplest.Flinger.AddApiKeyToSocket",{ApiKey:Cross.GetApiKey()}),b.emit("Coplest.Flinger.CanISendData",{ApiKey:Cross.GetApiKey()})}),b.on("Coplest.Flinger.ServerEvent",function(a){s(a.Command,a.Values)}),b.on("disconnect",function(){void 0!==a&&a&&console.log("Disconected from server")}),b.on("Coplest.Flinger.RAT",function(a){if(void 0!=a.Command)switch(a.Command){case"RATPoolConnection#Request":l(a.Values)}})},l=function(a){console.log(Cross.GetServerUri()+a.RPN),d=io(Cross.GetServerUri()+a.RPN,{query:"ApiKey="+Cross.GetApiKey()}),m(a)},m=function(b){d.on("connect",function(b){void 0!==a&&a&&console.log("Connection to RAT Pool Namespace succesfully")}),d.on("Coplest.Flinger.RAT",function(c){if(void 0!=c.Command)switch(c.Command){case"ConnectedToRPN#Response":void 0!==a&&a&&console.log("Socket Event: ConnectedToRPN#Response"),f=c.Values.SocketId,d.emit("Coplest.Flinger.RAT",{Command:"ConnectToRATServiceNamespace#Request",Values:{Namespace:b.Namespace}},function(c){void 0!==a&&a&&console.log("Socket Event: ConnectToRATServiceNamespace#Request"),n(c.Values,b)})}})},n=function(a,b){var c=Cross.SearchObjectByIdOnArray(b.Namespace.Id,a.Namespace);null!=c&&(console.log("RAT Service Socket URI: "+Cross.GetServerUri()+"/"+c.Id),e=io(Cross.GetServerUri()+"/"+c.Id,{query:"ApiKey="+Cross.GetApiKey()}),o(a,b))},o=function(b,c){e.on("Coplest.Flinger.RAT",function(b){if(void 0!=b.Command)switch(b.Command){case"ConnectedToRSN#Response":void 0!==a&&a&&console.log("Socket Event: ConnectedToRSN#Response"),f=b.Values.SocketId,e.emit("Coplest.Flinger.RAT",{Command:"UserJoinToPrivateRoom#Request",Values:{SocketId:e.id,RoomId:c.RoomId}});break;case"UserJoinToPrivateRoom#Response":void 0!==a&&a&&console.log("Socket Event: UserJoinToPrivateRoom#Response"),e.emit("Coplest.Flinger.RAT",{Command:"TakeMyUserSocketId#Request",Values:{SocketId:e.id,RoomId:c.RoomId}});break;case"HideRealCursor#Request":void 0!==a&&a&&console.log("HideRealCursor#Request"),RATHub.HideRealCursor();break;case"PrintCursor#Request":void 0!==a&&a&&console.log("PrintCursor#Request"),RATHub.PrintCursor();break;case"SetInitialPositionCursor#Request":void 0!==a&&a&&console.log("SetInitialPositionCursor#Request"),RATHub.SetInitialPositionCursor(b.Values);break;case"SetScreenshotInterval#Request":void 0!==a&&a&&console.log("SetScreenshotInterval#Request"),RATHub.SetScreenshotInterval(b.Values);break;case"SetPositionMouse#Request":void 0!==a&&a&&console.log("SetPositionMouse#Request"),RATHub.SetMousePosition(b.Values);break;case"SetScrollDelta#Request":void 0!==a&&a&&console.log("SetScrollDelta#Request"),RATHub.SetScrollDelta(b.Values);break;case"Click#Request":void 0!==a&&a&&console.log("Click#Request"),RATHub.VirtualClick(b.Values);break;default:console.log(b.Command)}})},p=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit(a.Command,a.Values)},q=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushInsight",a)},r=function(a){void 0!=b&&void 0!=Cross.GetApiKey()&&Cross.GetApiKey().length>0&&b.emit("Coplest.Flinger.PushScreenshot",a)},s=function(a,b){c=new CustomEvent(a,{detail:b}),document.dispatchEvent(c)},t=function(){return b};return{Initialize:g,GetSocket:t,PushInsight:q,PushScreenshot:r,PushEvent:p}}(),EventHub=function(){var a,b=[],c=[],d=[];document.addEventListener("InsightsQueue",function(){b.length>0&&(b.forEach(function(a){SocketHub.PushInsight({Command:"Click",Values:{ApiKey:Cross.GetApiKey(),Event:a}})}),b.length=0),c.length>0&&(c.forEach(function(a){SocketHub.PushInsight({Command:"Movement",Values:{Api:Cross.GetApiKey(),Event:a}})}),c.length=0),d.length>0&&(d.forEach(function(a){SocketHub.PushInsight({Command:"Scroll",Values:{Api:Cross.GetApiKey(),Event:a}})}),d.length=0)},!1),document.addEventListener("CanUseHeatmaps",function(b){void 0!==a&&a&&(console.log("CanUseHeatmaps:"),console.log(b)),1==b.detail.success&&(Cross.SetUseHeatmaps(b.detail.result),1==b.detail.result&&SocketHub.PushEvent({Command:"Coplest.Flinger.ICanUseHeatmaps",Values:{}}))},!1);var e=function(b){void 0!=b&&(a=b.Debug,i())},f=function(){document.addEventListener("click",l)},g=function(){document.onmousemove=k},h=function(){window.addEventListener("scroll",j,!1)},i=function(){var a=".dot {width: 1px; height: 1px; background-color: #000000; position: absolute;}",b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)},j=function(a){var b={Position:{X:this.scrollX,Y:this.scrollY},TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:{}};void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?void 0!=Cross.CanUseHeatmaps()&&null!=Cross.CanUseHeatmaps()&&1==Cross.CanUseHeatmaps()&&SocketHub.PushInsight({Command:"Scroll",Values:{ApiKey:Cross.GetApiKey(),Event:b,Pathname:window.location.pathname}}):d.push(b)},k=function(b){var d,e,f,g;b=b||window.event,null==b.pageX&&null!=b.clientX&&(e=b.target&&b.target.ownerDocument||document,f=e.documentElement,g=e.body,b.pageX=b.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),b.pageY=b.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),void 0!==a&&a&&(d=document.createElement("div"),d.className="dot",d.style.left=b.pageX+"px",d.style.top=b.pageY+"px",document.body.appendChild(d));var h={Position:{X:b.pageX,Y:b.pageY},Scroll:Cross.GetScrollPosition(),TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:{}};void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?void 0!=Cross.CanUseHeatmaps()&&null!=Cross.CanUseHeatmaps()&&1==Cross.CanUseHeatmaps()&&SocketHub.PushInsight({Command:"Movement",Values:{ApiKey:Cross.GetApiKey(),Event:h,Pathname:window.location.pathname}}):c.push(h)},l=function(c){var d={Position:{X:c.clientX,Y:c.clientY},Scroll:Cross.GetScrollPosition(),TimeStamp:Cross.TimeStamp(),Client:Cross.GetClientInformation(),Location:{}};void 0!==a&&a&&console.log("Mouse coords: ("+c.clientX+", "+c.clientY+")"),void 0!=SocketHub.GetSocket()&&SocketHub.GetSocket().connected===!0?void 0!=Cross.CanUseHeatmaps()&&null!=Cross.CanUseHeatmaps()&&1==Cross.CanUseHeatmaps()&&SocketHub.PushInsight({Command:"Click",Values:{ApiKey:Cross.GetApiKey(),Event:d,Pathname:window.location.pathname}}):b.push(d)},m=function(){return b},n=function(){return c},o=function(){return d};return{Initialize:e,ListenMouseClick:f,ListenMouseMovement:g,ListenMouseScroll:h,GetNotSentMouseClickEvents:m,GetNotSentMouseMovementEvents:n,GetNotSentMouseScrollEvents:o}}(),RATHub=function(){var a,b=10,c=".virtual-cursor {width: 10px; height: 17px; position: absolute;z-index:999999999;pointer-events: none!important;}",d='<img src="{CURSORSRC}" alt="virtual cursor" id="virtual-cursor" class="virtual-cursor">',e=".hide-real-cursor {cursor:none!important;}",f=0,g={X:0,Y:0},h=function(b){void 0!=b&&(a=b.Debug)},i=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.styleSheet?b.styleSheet.cssText=e:b.appendChild(document.createTextNode(e)),a.appendChild(b);var c=document.getElementsByTagName("html")[0];c.className+=" hide-real-cursor"},j=function(a){if(void 0!=a.X&&null!=a.X&&void 0!=a.Y&&null!=a.Y){g.X=a.X,g.Y=a.Y,document.querySelector("#virtual-cursor").style.left=g.X+"px",document.querySelector("#virtual-cursor").style.top=f+g.Y+"px";var b=document.elementFromPoint(g.X,g.Y);if(void 0!=b&&null!=b){var c=new MouseEvent("mouseover",{bubbles:!0,cancelable:!0,view:window});b.dispatchEvent(c),console.log(b)}}},k=function(a){if(void 0!=a.X&&null!=a.X&&void 0!=a.Y&&null!=a.Y){g.X=a.X,g.Y=a.Y;var b=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});document.elementFromPoint(g.X,g.Y).dispatchEvent(b)}},l=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.styleSheet?b.styleSheet.cssText=c:b.appendChild(document.createTextNode(c)),a.appendChild(b);var e=document.getElementsByTagName("body")[0],f=d.replace("{CURSORSRC}",Cross.GetCoreUri()+"/build/assets/fake_cursor.png"),g=f.toDOM();e.appendChild(g)},m=function(a){j(a)},n=function(a){b=a.Interval},o=function(a){if(void 0!=a.Delta&&null!=a.Delta){var b=80,c=document.documentElement.scrollTop||document.body.scrollTop;f=c+b*a.Delta*-1,window.scrollTo(0,f),j(g)}};return{Initialize:h,PrintCursor:l,SetMousePosition:j,SetInitialPositionCursor:m,SetScreenshotInterval:n,HideRealCursor:i,SetScrollDelta:o,VirtualClick:k}}(),ScreenshotHub=function(){var a,b,c=function(b){void 0!=b&&(a=b.Debug),d(),i()},d=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=e,b.src="https://cdn.rawgit.com/niklasvh/html2canvas/0.5.0-alpha1/dist/html2canvas.min.js",a.appendChild(b)},e=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript",b.onload=f,b.src="https://cdn.rawgit.com/niklasvh/html2canvas/0.5.0-alpha1/dist/html2canvas.svg.min.js",a.appendChild(b)},f=function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div");c.id="screenshot-result",c.style.display="none",void 0!==a&&a&&(console.log("html2canvas Library is loaded succesfully"),c.style.display="block"),b.appendChild(c),g()},g=function(){html2canvas(document.body).then(function(a){ctx=a.getContext("2d"),ctx.scale(.5,.5),ctx.save(),document.getElementById("screenshot-result").appendChild(a),1==b&&h()})},h=function(){if(b){var a=document.querySelector("#screenshot-result>canvas");SocketHub.PushScreenshot({Command:"Scroll",Values:{Base64Data:a.toDataURL(),Endpoint:document.location.pathname,ApiKey:Cross.GetApiKey()}})}},i=function(){function a(){b=void 0!=JSON.parse(this.responseText).result&&JSON.parse(this.responseText).result}var c="/api/Site/DiscoveryMode/"+Cross.GetApiKey(),d=new XMLHttpRequest;d.addEventListener("load",a),d.open("GET",Cross.GetServerUri()+c),d.send()};return{Initialize:c,TakeScreenshot:g}}(),Flinger=function(){var a,b,c=function(){a=document.querySelector("[data-flinger]"),b=void 0!=a.dataset.debug&&JSON.parse(a.dataset.debug),b===!0&&console.log("Flinger is on debug mode"),SocketHub.Initialize({Debug:b}),ScreenshotHub.Initialize({Debug:b}),RATHub.Initialize({Debug:b}),EventHub.Initialize({Debug:b}),EventHub.ListenMouseClick(),EventHub.ListenMouseMovement(),EventHub.ListenMouseScroll()};return{Initialize:c,GetNotSentMouseClickEvents:EventHub.GetNotSentMouseClickEvents,GetNotSentMouseMovementEvents:EventHub.GetNotSentMouseMovementEvents,GetNotSentMouseScrollEvents:EventHub.GetNotSentMouseScrollEvents}}();Flinger.Initialize();